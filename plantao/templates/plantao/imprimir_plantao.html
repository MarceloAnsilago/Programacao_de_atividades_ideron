{% extends "base.html" %}
{% load static %}
{% block title %}Impressão - Escala de Plantão{% endblock %}

{% block extra_css %}
<style>
/* Apenas para visualização na tela */
#container-impressao {
    background: #fff;
    box-shadow: 0 0 12px #eee;
    border-radius: 8px;
    padding: 24px;
    max-width: 900px;
    margin: 30px auto;
}

/* Esconde o botão de imprimir ao imprimir */
@media print {
    .no-print, .no-print * {
        display: none !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div id="container-impressao">
    <!-- Cabeçalho e título -->
    <div style="display: flex; align-items: center; gap: 16px;">
       
        <div>
            <h2 style="margin:0; font-weight: 600; font-size: 2em;">
                <i class="bi bi-table"></i> Escala de Plantão para recebimento de vacinas, agrotóxicos e produtos biológicos
            </h2>
            <div style="font-size: 1.1em; color: #333;">
                {{ plantao.periodo_inicial|date:"d/m/Y" }} a {{ plantao.periodo_final|date:"d/m/Y" }}
            </div>
        </div>
    </div>

    <!-- Tabela da escala -->
    <table class="table table-bordered align-middle" style="margin-top: 28px;">
        <thead>
            <tr>
                <th>Semana</th>
                <th>Período</th>
                <th>Servidor</th>
                <th>Telefone</th>
            </tr>
        </thead>
        <tbody>
            {% for semana in semanas %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ semana.data_inicio|date:"d/m/Y" }} a {{ semana.data_fim|date:"d/m/Y" }}</td>
                <td>{% if semana.servidor %}{{ semana.servidor.nome }}{% endif %}</td>
                <td>{% if semana.servidor %}{{ semana.servidor.telefone }}{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Botões -->
<div class="no-print" style="text-align:center; margin-top: 20px;">
    <a href="{% url 'plantao:lista_plantoes' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Voltar para a lista
    </a>
    <button type="button" onclick="imprimirEscala()" class="btn btn-secondary ms-2">
        <i class="bi bi-printer"></i> Imprimir
    </button>
</div>

<!-- Script de impressão limpa -->
<script>
function imprimirEscala() {
    var conteudo = document.getElementById('container-impressao').innerHTML;
    var width = window.screen.availWidth;
    var height = window.screen.availHeight;
    var win = window.open('', '', 'width=' + width + ',height=' + height + ',left=0,top=0');
    win.document.write('<html><head><title>Impressão - Escala de Plantão</title>');
    win.document.write('<style>');
    win.document.write('body{background:#fff;margin:24px;font-family:sans-serif;}');
    win.document.write('h2{font-size:2em;margin-bottom:0.2em;}');
    win.document.write('table{width:100%;border-collapse:collapse;margin-top:24px;}');
    win.document.write('th,td{border:1px solid #888;padding:8px 12px;text-align:left;font-size:1.1em;}');
    win.document.write('th{background:#f3f3f3;}');
    win.document.write('tr:nth-child(even){background:#fafbfc;}');
    win.document.write('</style>');
    win.document.write('</head><body>');
    win.document.write(conteudo);
    win.document.write('</body></html>');
    win.document.close();
    setTimeout(function(){
        win.print();
        win.close();
    }, 300);
}

</script>
{% endblock %}
